# add population weights
left_join(weights, by = join_by(weights_id == system)) %>%
select(-weights_id) %>%
# calculate population-days as weights for loess fit
# first calculate reporting interval i.e. days til next report for that location
arrange(date, .by=system) %>%
mutate(
interval = ((lead(date, default = max(date)+ddays(1)))-date)/ddays(1), .by=system,
# interval multiplier floor is at 0.5 (for the max of 2 entries in a single day
# ceiling is at 7, so as to not over-weight systems that miss time
pop_day = pop_weight * (min(interval, 7) %>% max(0.5))) %>%
## label runs between gaps for each system
group_by(system) %>%
mutate(
gap = if_else(date > dplyr::lag(date, default=lubridate::origin)+dweeks(2), 1, 0),
run=cumsum(gap),
gap=NULL,
smooth_group = paste0(system, "_", run)) %>% ungroup() %>%
arrange(system, date)
# save(full_sample, weights, file="current.Rda")
wva_pal <- c("#49a667", "#b6c459", "#8fa1ef", "#fdae61", "#f45489")
### -----
### Load data ----
# load("current.Rda")
# Generate smooth and wvas
# smooth_operator automaticaly filters for western mass
# we can customize that for future iterations
dfreg <- smooth_operator(full_sample, time_years=1)
thresholds_reg <- wtd_ww_threshold_breaks(dfreg$avg_7d_covid_conc, wts=dfreg$pop_day)
### DEBUGGING
df <- full_sample
max(df$date)
format(df$date)
max(df$date) - years(1)
years(1)
max(df$date)
df$maxdate <- max(df$date)
df$cutoff <- max(df$date) - years(1)
View(df)
df %>% filter(date > cutoff)
df %>% filter(date > cutoff & wmass)
df %>% filter(date > cutoff & wmass) %>% View
df %>% filter(date > cutoff) %>% View
table(df$date > df$cutoff)
df %>% filter(wmass) %>% View
df %>% filter(wmass) %>% arrange(desc(date)) %>% View
### DEBUGGING
df <- full_sample
df %>% filter(wmass) %>% arrange(desc(date)) %>% View
View(raw_sample_current)
View(raw_sample_arch)
full_sample %>% filter(wmass) %>% mutate(year = year(date), month = month(date))
full_sample %>% filter(wmass) %>% mutate(year = year(date), month = month(date)) %>%
ggplot() +
geom_bar(aes(month)) %>% facet_wrap(~year, ncol=1)
full_sample %>% filter(wmass) %>%
mutate(year = year(date), month = month(date)) %>%
ggplot() +
geom_bar(aes(month)) +
facet_wrap(~year, ncol=1)
full_sample %>% filter(wmass) %>%
mutate(year = year(date), month = month(date)) %>%
ggplot() +
geom_bar(aes(as.factor(month))) +
facet_wrap(~year, ncol=1)
full_sample %>% filter(wmass) %>%
mutate(year = year(date), month = month(date)) %>%
filter(year > 2022) %>%
ggplot() +
geom_bar(aes(as.factor(month))) +
facet_wrap(~year, ncol=1)
full_sample %>%
# filter(wmass) %>%
mutate(year = year(date), month = month(date)) %>%
filter(year > 2022) %>%
ggplot() +
geom_bar(aes(as.factor(month))) +
facet_wrap(~year, ncol=1)
Sys.setenv(RSTUDIO_PANDOC = "/Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64")
#!/usr/bin/env Rscript
# Load libraries
library(rmarkdown)
# Base path to your repo
base_path <- "/Users/RSF/Library/CloudStorage/Dropbox/My Mac (temp’s MacBook Pro)/Documents/GitHub/western-mass-covid"
# File paths
input_file  <- file.path(base_path, "report.Rmd")   # your .Rmd source
output_file <- "wastewater.html"                    # knitted output file name
output_path <- file.path(base_path, output_file)
# Knit the report directly to wastewater.html in base_path
rmarkdown::render(
input       = input_file,
output_file = output_file,
output_dir  = base_path
)
# Base path to your repo
base_path <- "/Users/RSF/Library/CloudStorage/Dropbox/My Mac (temp’s MacBook Pro)/Documents/GitHub/western-mass-covid"
# File paths
input_file  <- file.path(base_path, "wastewater_report.Rmd")   # your .Rmd source
output_file <- "wastewater.html"                    # knitted output file name
output_path <- file.path(base_path, output_file)
# Knit the report directly to wastewater.html in base_path
rmarkdown::render(
input       = input_file,
output_file = output_file,
output_dir  = base_path
)
# Archive copy with date-stamped name
today <- Sys.Date()
archive_dir  <- file.path(base_path, "archive")
archive_file <- file.path(archive_dir, paste0("wastewater-", today, ".html"))
file.copy(output_path, archive_file, overwrite = TRUE)
# Docs copy for GitHub Pages
docs_file <- file.path(base_path, "docs/wastewater.html")
file.copy(output_path, docs_file, overwrite = TRUE)
# Git commit & push
setwd(base_path)
system("git add docs/wastewater.html")
system(paste("git add", archive_file))
Sys.setenv
Sys.setenv(RSTUDIO_PANDOC = "/Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/aarch64")
system(paste("git add", archive_file))
system(paste("git add", shQuote(archive_file)))
system('git commit -m "Automated wastewater report update"')
system("git push")
library(tidyverse)
library(here)
library(lubridate)
library(ggthemes)
library(scales)
library(patchwork)
library(readxl)
library(ggtext)
options(scipen = 999)
source("wva_calculator.R")
source("mytheme.R")
### Download and initial cleaning ----
url_current <- "https://www.mass.gov/doc/wastewater-dashboard-data/download"
url_arch23 <- "https://www.mass.gov/doc/2023-2024-archived-wastewater-dashboard-data/download"
url_arch24 <- "https://www.mass.gov/doc/archived-wastewater-surveillance-dashboard-data-2024-2025/download"
download.file(url_current, destfile = "sample_current.xlsx", mode = "wb")
download.file(url_arch23, destfile = "sample_arch23.xlsx", mode = "wb")
download.file(url_arch24, destfile = "sample_arch24.xlsx", mode = "wb")
raw_sample_current <-
read_excel(path = "sample_current.xlsx", sheet = "Wastewater Testing Data") %>%
rename_all(~ str_to_lower(.)) %>%
rename_all( ~ str_replace_all(., "[ ]", "_")) %>%
mutate(date = ymd(sample_collection_date), source="current") %>%
write_csv(paste0(here("data_downloads", paste0(Sys.Date(), "_sample_current.csv"))))
raw_sample_arch23 <-
read_excel(path = "sample_arch23.xlsx", sheet = "Wastewater Testing Data") %>%
rename_all(~ str_to_lower(.)) %>%
rename_all( ~ str_replace_all(., "[ ]", "_")) %>%
mutate(date = ymd(sample_collection_date), source="arch") %>%
write_csv(paste0(here("data_downloads", paste0(Sys.Date(), "_sample_arch.csv"))))
raw_sample_arch24 <-
read_excel(path = "sample_arch24.xlsx", sheet = "Wastewater Testing Data") %>%
rename_all(~ str_to_lower(.)) %>%
rename_all( ~ str_replace_all(., "[ ]", "_")) %>%
mutate(date = ymd(sample_collection_date), source="arch") %>%
write_csv(paste0(here("data_downloads", paste0(Sys.Date(), "_sample_arch.csv"))))
weights <- read.csv("better_pop_weights_Aug2024.csv") %>%
select(-mgd) %>% rename(pop_weight = users) %>%
mutate(pop_weight = as.numeric(pop_weight))
wmass_counties <- c("Hampden", "Franklin", "Hampshire", "Berkshire")
nvalley_counties <- c("Franklin", "Hampshire")
svalley_counties <- c("Hampden", "Hampshire")
berkshire <- "Berkshire"
### Set time parameter
time_years <- 1
time_months <- time_years * 12
### Prepare the data
full_sample <-
# combine archive and current data
bind_rows(raw_sample_arch23 %>%
filter(date < min(raw_sample_arch24$date)),
raw_sample_arch24 %>%
filter(date < min(raw_sample_current$date)),
raw_sample_current) %>%
#select(-respiratory_season)) %>%
# rename columns
rename(
"avg_7d_covid_conc" = '7_day_average_of_sars-cov-2_concentration',
"county" = county_of_sampling_location,
"city_sample" = city_of_sampling_location,
"system" = name_of_sampling_location) %>%
# convert to copies / mL
mutate(avg_7d_covid_conc = avg_7d_covid_conc/1000) %>%
# modify for log-scale axis display by adding small constant to zero values
mutate(avg_7d_covid_conc = ifelse(avg_7d_covid_conc == 0, .01, avg_7d_covid_conc)) %>%
# remove unused rows
select(-c(tester, site_type, 'units_(measuring_concentration)', state_of_sampling_location)) %>%
# reorganize columns
relocate(date) %>% relocate(city_sample, .after = date) %>% relocate(county, .after = date) %>%
# shift to uniform lower case
mutate(city_sample = str_to_lower(city_sample),
# create lowercase version of system for easy join to pop weights
weights_id = str_to_lower(system)) %>%
# add geographical groupings
mutate(
wmass = county %in% wmass_counties,
nvalley = county %in% nvalley_counties,
svalley = county %in% svalley_counties) %>%
# remove extraneous columns
select(date, county, system, avg_7d_covid_conc, weights_id, wmass, nvalley, svalley) %>%
# add population weights
left_join(weights, by = join_by(weights_id == system)) %>%
select(-weights_id) %>%
# calculate population-days as weights for loess fit
# first calculate reporting interval i.e. days til next report for that location
arrange(date, .by=system) %>%
mutate(
interval = ((lead(date, default = max(date)+ddays(1)))-date)/ddays(1), .by=system,
# interval multiplier floor is at 0.5 (for the max of 2 entries in a single day
# ceiling is at 7, so as to not over-weight systems that miss time
pop_day = pop_weight * (min(interval, 7) %>% max(0.5))) %>%
## label runs between gaps for each system
group_by(system) %>%
mutate(
gap = if_else(date > dplyr::lag(date, default=lubridate::origin)+dweeks(2), 1, 0),
run=cumsum(gap),
gap=NULL,
smooth_group = paste0(system, "_", run)) %>% ungroup() %>%
arrange(system, date)
# save(full_sample, weights, file="current.Rda")
wva_pal <- c("#49a667", "#b6c459", "#8fa1ef", "#fdae61", "#f45489")
### -----
### Load data ----
# load("current.Rda")
### Set time parameter
time_years <- 1
time_months <- time_years * 12
### Prepare the data
full_sample <-
# combine archive and current data
bind_rows(raw_sample_arch23 %>%
filter(date < min(raw_sample_arch24$date)),
raw_sample_arch24 %>%
filter(date < min(raw_sample_current$date)),
raw_sample_current) %>%
#select(-respiratory_season)) %>%
# rename columns
rename(
"avg_7d_covid_conc" = '7_day_average_of_sars-cov-2_concentration',
"county" = county_of_sampling_location,
"city_sample" = city_of_sampling_location,
"system" = name_of_sampling_location) %>%
# convert to copies / mL
mutate(avg_7d_covid_conc = avg_7d_covid_conc/1000) %>%
# modify for log-scale axis display by adding small constant to zero values
mutate(avg_7d_covid_conc = ifelse(avg_7d_covid_conc == 0, .01, avg_7d_covid_conc)) %>%
# remove unused rows
select(-c(tester, site_type, 'units_(measuring_concentration)', state_of_sampling_location)) %>%
# reorganize columns
relocate(date) %>% relocate(city_sample, .after = date) %>% relocate(county, .after = date) %>%
# shift to uniform lower case
mutate(city_sample = str_to_lower(city_sample),
# create lowercase version of system for easy join to pop weights
weights_id = str_to_lower(system)) %>%
# add geographical groupings
mutate(
wmass = county %in% wmass_counties,
nvalley = county %in% nvalley_counties,
svalley = county %in% svalley_counties) %>%
# remove extraneous columns
select(date, county, system, avg_7d_covid_conc, weights_id, wmass, nvalley, svalley) %>%
# add population weights
left_join(weights, by = join_by(weights_id == system)) %>%
select(-weights_id) %>%
# calculate population-days as weights for loess fit
# first calculate reporting interval i.e. days til next report for that location
arrange(date, .by=system) %>%
mutate(
interval = ((lead(date, default = max(date)+ddays(1)))-date)/ddays(1), .by=system,
# interval multiplier floor is at 0.5 (for the max of 2 entries in a single day
# ceiling is at 7, so as to not over-weight systems that miss time
pop_day = pop_weight * (min(interval, 7) %>% max(0.5))) %>%
## label runs between gaps for each system
group_by(system) %>%
mutate(
gap = if_else(date > dplyr::lag(date, default=lubridate::origin)+dweeks(2), 1, 0),
run=cumsum(gap),
gap=NULL,
smooth_group = paste0(system, "_", run)) %>% ungroup() %>%
arrange(system, date)
wva_pal <- c("#49a667", "#b6c459", "#8fa1ef", "#fdae61", "#f45489")
# Generate smooth and wvas
# smooth_operator automaticaly filters for western mass
# we can customize that for future iterations
dfreg <- smooth_operator(full_sample, time_years=1)
thresholds_reg <- wtd_ww_threshold_breaks(dfreg$avg_7d_covid_conc, wts=dfreg$pop_day)
### construct regional plot
region <-
dfreg %>%
ggplot() +
geom_hline(yintercept = thresholds_reg[2:5], color="grey50", linetype="dotted") +
geom_point(aes(date, avg_7d_covid_conc, size=pop_day, color=wva_point), alpha=.35) +
geom_line(aes(date,  y_smoothed, group=1), color="darkblue", linewidth=1.25) +
scale_y_log10(limits = c(10, 8000)) +
scale_color_manual(values = wva_pal) +
labs(x = "Date",
y = "7-day COVID Concentration (copies/mL)",
color= "Wastewater Viral\nActivity Level") +
guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 1)),
fill = guide_legend(reverse=TRUE),
size="none") +
mytheme()
plot_title_reg <- ifelse(time_years == 1,
paste0("wma_wastewater_", max(dfreg$date), "_region",  ".tiff"),
paste0("wma_wastewater_", max(dfreg$date), "_region_", time_years, "YEAR.tiff"))
width <- ifelse(time_years == 1, 2100, 3300)
height <- 1900
ggsave(region, path = here("plots/"), filename = plot_title_reg,
width = width, height = height, units = "px", bg="white")
plot_title_reg
subtitle <- paste0("From ", min(dfreg$date), " to ", max(dfreg$date),
"\nCurrent WVA level: ",  dfreg %>% arrange(date) %>% pull(wva_lvl) %>%  last() %>% as.character(),
"\nCurrent WVA score: ",  dfreg %>% arrange(date) %>% pull(wva_score) %>%  last() %>% as.character())
cat(subtitle)
sewer_num <- length(dfreg %>% pull(system) %>% unique())
plot(region)
sewer_num <- length(dfreg %>% pull(system) %>% unique())
sewer_num
plot(region)
counties <- full_sample %>% filter(date > max(date) - years(time_years) & wmass) %>% pull(county) %>% unique()
# create the data.frame to hold the county smooths
dfcount <- data.frame(matrix(ncol = ncol(full_sample)))[-1,]
colnames(dfcount) <- names(full_sample)
summ <- data.frame(county = NA, note = NA)[-1,]
# loop through counties
for (i in seq_along(counties)){
# create smooths
temp <- smooth_operator(full_sample %>% filter(county == counties[i]), time_years=1)
dfcount <- rbind(dfcount, temp)
# create summary annotations
tempnote <- data.frame(county = counties[i],
note = paste0(max(temp$date),"\nWVA level: ",  temp %>% arrange(date) %>% pull(wva_lvl) %>%  last() %>% as.character(),"\nWVA score: ",  temp %>% arrange(date) %>% pull(wva_score) %>%  last() %>% as.character()))
summ <- rbind(summ, tempnote)
# create dataframe of thresholds to pass to hline
}
# add xy coordinates to annotations
summ$x <- min(temp$date)
summ$y <- 11
#### county plot ----
county_plot <-
dfcount %>%
ggplot() +
geom_point(aes(date, avg_7d_covid_conc, size=pop_day, color=wva_point), alpha=.35) +
geom_line(aes(date,  y_smoothed, group=1), color="darkblue", linewidth=1.15) +
scale_y_log10(limits = c(10, 8000)) +
scale_color_manual(values = wva_pal) +
guides(color = guide_legend(reverse=TRUE, override.aes = list(alpha = 1)),
fill = guide_legend(reverse=TRUE),
size="none") +
labs(x = "Date",
y = "7-day COVID Concentration (copies/mL)",
color= "Wastewater Viral\nActivity Level") +
geom_label(data = summ,
aes(x=x, y=y, label = note), color="blue", hjust=0,vjust=0,
size=2.5) +
mytheme() + # set the left align here +
theme(plot.title = element_text(size=12)) +
facet_wrap(~county, ncol=2)
plot_title_count <- paste0("wma_wastewater_", max(dfreg$date), "_counties", ".tiff")
width = 1992*1.25
height = 1200*1.25
ggsave(county_plot, path = here("plots/"), filename = plot_title_count,
width = width, height = height, units = "px", bg="white")
plot(county_plot)
smooth_groups <- full_sample %>%
filter(date > max(date) - months(6) & wmass) %>% select(system, group=smooth_group) %>% unique()
# create the data.frame to hold the system smooths
dfsys <- data.frame(matrix(ncol = ncol(full_sample)))[-1,]
colnames(dfsys) <- names(full_sample)
summ_temp <- data.frame(max_date = NA, system = NA, smooth_group = NA, note = NA)[-1,]
summ_temp
View(summ_temp)
# loop through counties
for (i in seq_along(smooth_groups$group)){
# create smooths
temp <- smooth_operator(full_sample %>% filter(date > max(date) - years(time_years)) %>% filter(smooth_group == smooth_groups$group[i]), time_years=1)
# qc <- temp %>% select(date, smooth_group)
dfsys <- rbind(dfsys, temp)
# create summary annotations by system
tempnote <- data.frame(max_date = max(temp$date),
system = smooth_groups$system[i],
smooth_group = smooth_groups$group[i],
note =
paste0(max(temp$date),"\nWVA level: ",
temp %>% arrange(date) %>% pull(wva_lvl) %>%  last() %>% as.character(),"\nWVA score: ",  temp %>% arrange(date) %>% pull(wva_score) %>%  last() %>% as.character()))
summ_temp <- rbind(summ_temp, tempnote)
# create dataframe of thresholds to pass to hline
}
View(smooth_groups)
smooth_groups <- smooth_groups[smooth_groups$system != "Sunderland WWTP"]
smooth_groups$system != "Sunderland WWTP"
smooth_groups[smooth_groups$system != "Sunderland WWTP"]
### Debugging
smooth_groups <- smooth_groups[smooth_groups$system != "Sunderland WWTP",]
View(smooth_groups)
o
# loop through counties
for (i in seq_along(smooth_groups$group)){
# create smooths
temp <- smooth_operator(full_sample %>% filter(date > max(date) - years(time_years)) %>% filter(smooth_group == smooth_groups$group[i]), time_years=1)
# qc <- temp %>% select(date, smooth_group)
dfsys <- rbind(dfsys, temp)
# create summary annotations by system
tempnote <- data.frame(max_date = max(temp$date),
system = smooth_groups$system[i],
smooth_group = smooth_groups$group[i],
note =
paste0(max(temp$date),"\nWVA level: ",
temp %>% arrange(date) %>% pull(wva_lvl) %>%  last() %>% as.character(),"\nWVA score: ",  temp %>% arrange(date) %>% pull(wva_score) %>%  last() %>% as.character()))
summ_temp <- rbind(summ_temp, tempnote)
# create dataframe of thresholds to pass to hline
}
smooth_groups <- smooth_groups[smooth_groups$system != "Amherst WWTP",]
# loop through counties
for (i in seq_along(smooth_groups$group)){
# create smooths
temp <- smooth_operator(full_sample %>% filter(date > max(date) - years(time_years)) %>% filter(smooth_group == smooth_groups$group[i]), time_years=1)
# qc <- temp %>% select(date, smooth_group)
dfsys <- rbind(dfsys, temp)
# create summary annotations by system
tempnote <- data.frame(max_date = max(temp$date),
system = smooth_groups$system[i],
smooth_group = smooth_groups$group[i],
note =
paste0(max(temp$date),"\nWVA level: ",
temp %>% arrange(date) %>% pull(wva_lvl) %>%  last() %>% as.character(),"\nWVA score: ",  temp %>% arrange(date) %>% pull(wva_score) %>%  last() %>% as.character()))
summ_temp <- rbind(summ_temp, tempnote)
# create dataframe of thresholds to pass to hline
}
# create smooths
i = 1
temp <- smooth_operator(full_sample %>% filter(date > max(date) - years(time_years)) %>% filter(smooth_group == smooth_groups$group[i]), time_years=1)
# create smooths
i = 9
for (i in seq_along(smooth_groups$group)){
cat(i)
# create smooths
temp <- smooth_operator(full_sample %>% filter(date > max(date) - years(time_years)) %>% filter(smooth_group == smooth_groups$group[i]), time_years=1)
# qc <- temp %>% select(date, smooth_group)
dfsys <- rbind(dfsys, temp)
# create summary annotations by system
tempnote <- data.frame(max_date = max(temp$date),
system = smooth_groups$system[i],
smooth_group = smooth_groups$group[i],
note =
paste0(max(temp$date),"\nWVA level: ",
temp %>% arrange(date) %>% pull(wva_lvl) %>%  last() %>% as.character(),"\nWVA score: ",  temp %>% arrange(date) %>% pull(wva_score) %>%  last() %>% as.character()))
summ_temp <- rbind(summ_temp, tempnote)
# create dataframe of thresholds to pass to hline
}
smooth_groups <- full_sample %>%
filter(date > max(date) - months(6) & wmass) %>% select(system, group=smooth_group) %>% unique()
for (i in seq_along(smooth_groups$group)){
cat(i)
# create smooths
temp <- smooth_operator(full_sample %>% filter(date > max(date) - years(time_years)) %>% filter(smooth_group == smooth_groups$group[i]), time_years=1)
# qc <- temp %>% select(date, smooth_group)
dfsys <- rbind(dfsys, temp)
# create summary annotations by system
tempnote <- data.frame(max_date = max(temp$date),
system = smooth_groups$system[i],
smooth_group = smooth_groups$group[i],
note =
paste0(max(temp$date),"\nWVA level: ",
temp %>% arrange(date) %>% pull(wva_lvl) %>%  last() %>% as.character(),"\nWVA score: ",  temp %>% arrange(date) %>% pull(wva_score) %>%  last() %>% as.character()))
summ_temp <- rbind(summ_temp, tempnote)
# create dataframe of thresholds to pass to hline
}
View(full_sample)
full_sample %>% count(system, smooth_group)
cat(full_sample %>% count(system, smooth_group))
print(full_sample %>% count(system, smooth_group))
full_sample
full_sample %>% count(system, smooth_group)
for (i in seq_along(smooth_groups$group)){
cat(i)
# create smooths
temp <- smooth_operator(full_sample %>% filter(date > max(date) - years(time_years)) %>% filter(smooth_group == smooth_groups$group[i]), time_years=1)
# qc <- temp %>% select(date, smooth_group)
dfsys <- rbind(dfsys, temp)
# create summary annotations by system
tempnote <- data.frame(max_date = max(temp$date),
system = smooth_groups$system[i],
smooth_group = smooth_groups$group[i],
note =
paste0(max(temp$date),"\nWVA level: ",
temp %>% arrange(date) %>% pull(wva_lvl) %>%  last() %>% as.character(),"\nWVA score: ",  temp %>% arrange(date) %>% pull(wva_score) %>%  last() %>% as.character()))
summ_temp <- rbind(summ_temp, tempnote)
# create dataframe of thresholds to pass to hline
}
smooth_groups <- smooth_groups[-6,]
for (i in seq_along(smooth_groups$group)){
cat(i)
# create smooths
temp <- smooth_operator(full_sample %>% filter(date > max(date) - years(time_years)) %>% filter(smooth_group == smooth_groups$group[i]), time_years=1)
# qc <- temp %>% select(date, smooth_group)
dfsys <- rbind(dfsys, temp)
# create summary annotations by system
tempnote <- data.frame(max_date = max(temp$date),
system = smooth_groups$system[i],
smooth_group = smooth_groups$group[i],
note =
paste0(max(temp$date),"\nWVA level: ",
temp %>% arrange(date) %>% pull(wva_lvl) %>%  last() %>% as.character(),"\nWVA score: ",  temp %>% arrange(date) %>% pull(wva_score) %>%  last() %>% as.character()))
summ_temp <- rbind(summ_temp, tempnote)
# create dataframe of thresholds to pass to hline
}
full_sample %>% count(system, smooth_group)
